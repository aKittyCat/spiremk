<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Spire Market Item List & Price</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "fantasy-gold": "#D4AF37",
              "fantasy-purple": "#6B46C1",
              "fantasy-dark": "#1F2937",
              "fantasy-red": "#DC2626",
            },
          },
        },
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:wght@400;600&display=swap");

      .fantasy-font {
        font-family: "Cinzel", serif;
      }
      .content-font {
        font-family: "Crimson Text", serif;
      }

      .scroll-container {
        max-height: 70vh;
        overflow-y: auto;
      }

      .admin-panel {
        display: none;
      }
      .admin-panel.active {
        display: block;
      }

      .rarity-common {
        background-color: #6b7280;
        color: white;
      }
      .rarity-uncommon {
        background-color: #10b981;
        color: white;
      }
      .rarity-rare {
        background-color: #3b82f6;
        color: white;
      }
      .rarity-very-rare {
        background-color: #8b5cf6;
        color: white;
      }
      .rarity-legendary {
        background-color: #f59e0b;
        color: white;
      }
      .rarity-artifact {
        background-color: #ef4444;
        color: white;
      }
      .rarity-mundane {
        background-color: #2d0097;
        color: white;
      }
      .hint-badge {
        font-size: 0.75rem;
        padding: 0.15rem 0.5rem;
        border-radius: 0.375rem;
      }

      #itemsList table {
        table-layout: fixed;
        width: 100%;
      }

      /* ‡∏¢‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á checkbox + ‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢ */
      #itemsList thead th:first-child,
      #itemsList tbody td:first-child {
        text-align: left;
        padding-left: 0.5rem;
        padding-right: 0.35rem;
        width: 2.25rem; /* ‡∏û‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡πä‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏ö‡∏≤‡∏¢ ‡πÜ */
      }

      /* ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°" ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ñ‡∏±‡∏î‡∏à‡∏≤‡∏Å checkbox ‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ */
      #itemsList thead th:nth-child(2),
      #itemsList tbody td:nth-child(2) {
        text-align: left;
        padding-left: 0.25rem;
        padding-right: 1rem;
      }

      #itemsList input.row-select:disabled {
        opacity: 0.35;
        cursor: not-allowed;
      }
    </style>
  </head>

  <body
    class="bg-gradient-to-br from-gray-900 via-purple-900 to-gray-800 min-h-screen text-white"
  >
    <!-- Header -->
    <header
      class="bg-black bg-opacity-50 backdrop-blur-sm border-b border-fantasy-gold"
    >
      <div class="container mx-auto px-4 py-6">
        <div class="flex items-center justify-between">
          <h1
            href="index.html"
            class="fantasy-font text-3xl md:text-4xl font-bold text-fantasy-gold"
          >
            üè∞ The Spire Market
          </h1>
          <button
            id="adminToggle"
            class="bg-fantasy-purple hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors"
          >
            Admin Panel
          </button>
        </div>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-black bg-opacity-30 backdrop-blur-sm sticky top-0 z-40">
      <div class="container mx-auto px-4">
        <div class="flex flex-wrap justify-center space-x-2 md:space-x-6 py-4">
          <button
            class="nav-btn active bg-fantasy-gold text-black px-4 py-2 rounded-lg font-semibold transition-all hover:scale-105"
            data-page="guide"
          >
            üìú ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
          </button>
          <button
            class="nav-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg font-semibold transition-all hover:scale-105"
            data-page="mundane"
          >
            ‚ò†Ô∏è Mundane Item
          </button>
          <button
            class="nav-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg font-semibold transition-all hover:scale-105"
            data-page="gemstone"
          >
            üíé Gemstone
          </button>
          <button
            class="nav-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg font-semibold transition-all hover:scale-105"
            data-page="items"
          >
            ‚öîÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
          </button>
          <button
            class="nav-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg font-semibold transition-all hover:scale-105"
            data-page="crafting"
          >
            üî® Crafting
          </button>
          <button
            class="nav-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg font-semibold transition-all hover:scale-105"
            data-page="updates"
          >
            üì∞ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-none mx-auto px-4 py-8">
      <!-- Admin Panel -->
      <div
        id="adminPanel"
        class="admin-panel mb-8 bg-black bg-opacity-50 rounded-xl p-6 border border-fantasy-red"
      >
        <h2 class="fantasy-font text-2xl font-bold text-fantasy-red mb-4">
          üõ°Ô∏è Admin Panel
        </h2>
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Add/Edit Item Form -->
          <div class="bg-gray-800 rounded-lg p-4">
            <div class="flex items-center justify-between mb-2">
              <h3 class="font-bold text-fantasy-gold">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏≠‡πÄ‡∏ó‡∏°</h3>
              <span
                id="itemEditHint"
                class="hidden bg-yellow-500 text-black hint-badge"
                >‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</span
              >
            </div>
            <form id="itemForm" class="space-y-3">
              <input type="hidden" id="itemId" />
              <input
                type="text"
                id="itemName"
                placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°"
                class="w-full p-2 rounded bg-gray-700 text-white"
                required
              />
              <input
                type="url"
                id="itemNameLink"
                placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"
                class="w-full p-2 rounded bg-gray-700 text-white"
              />
              <select
                id="itemAttune"
                class="w-full p-2 rounded bg-gray-700 text-white"
              >
                <option value="No">No Attunement</option>
                <option value="Yes">Requires Attunement</option>
              </select>
              <select
                id="itemPerDis"
                class="w-full p-2 rounded bg-gray-700 text-white"
              >
                <option value="‡∏ñ‡∏≤‡∏ß‡∏£">‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ñ‡∏≤‡∏ß‡∏£</option>
                <option value="‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á">‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á</option>
              </select>
              <input
                type="text"
                id="itemType"
                placeholder="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"
                class="w-full p-2 rounded bg-gray-700 text-white"
                required
              />
              <input
                type="text"
                id="itemPrice"
                placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤"
                class="w-full p-2 rounded bg-gray-700 text-white"
                required
              />
              <select
                id="itemTier"
                class="w-full p-2 rounded bg-gray-700 text-white"
              >
                <option value="Tier 0">Tier 0</option>
                <option value="Tier 1">Tier 1</option>
                <option value="Tier 2">Tier 2</option>
                <option value="Tier 3">Tier 3</option>
                <option value="Tier 4">Tier 4</option>
                <option value="Tier 5">Tier 5</option>
              </select>
              <select
                id="itemRarity"
                class="w-full p-2 rounded bg-gray-700 text-white"
              >
                <option value="Common">Common</option>
                <option value="Uncommon">Uncommon</option>
                <option value="Rare">Rare</option>
                <option value="Very Rare">Very Rare</option>
                <option value="Legendary">Legendary</option>
                <option value="Artifact">Artifact</option>
                <option value="Mundane">Mundane</option>
              </select>
              <input
                type="text"
                id="itemBook"
                placeholder="‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠"
                class="w-full p-2 rounded bg-gray-700 text-white"
                required
              />
              <textarea
                id="itemDescription"
                placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"
                class="w-full p-2 rounded bg-gray-700 text-white h-20"
              ></textarea>
              <div class="flex gap-2">
                <button
                  type="submit"
                  class="flex-1 bg-fantasy-gold text-black py-2 rounded font-bold hover:bg-yellow-500 transition-colors"
                >
                  ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
                </button>
                <button
                  type="button"
                  id="itemCancelEdit"
                  class="px-4 py-2 rounded bg-gray-600 hover:bg-gray-700"
                >
                  ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                </button>
              </div>
            </form>
          </div>

          <!-- Add/Edit Update Form -->
          <div class="bg-gray-800 rounded-lg p-4">
            <div class="flex items-center justify-between mb-2">
              <h3 class="font-bold text-fantasy-gold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó</h3>
              <span
                id="updateEditHint"
                class="hidden bg-yellow-500 text-black hint-badge"
                >‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</span
              >
            </div>
            <form id="updateForm" class="space-y-3">
              <input type="hidden" id="updateId" />
              <input
                type="text"
                id="updateTitle"
                placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠"
                class="w-full p-2 rounded bg-gray-700 text-white"
                required
              />
              <input
                type="date"
                id="updateDate"
                class="w-full p-2 rounded bg-gray-700 text-white"
                required
              />
              <textarea
                id="updateContent"
                placeholder="‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤"
                class="w-full p-2 rounded bg-gray-700 text-white h-20"
                required
              ></textarea>
              <div class="flex gap-2">
                <button
                  type="submit"
                  class="flex-1 bg-fantasy-purple text-white py-2 rounded font-bold hover:bg-purple-700 transition-colors"
                >
                  ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó
                </button>
                <button
                  type="button"
                  id="updateCancelEdit"
                  class="px-4 py-2 rounded bg-gray-600 hover:bg-gray-700"
                >
                  ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Page Content -->
      <div id="pageContent">
        <!-- Guide Page -->
        <div id="guidePage" class="page-content">
          <div class="bg-black bg-opacity-50 rounded-xl p-8 backdrop-blur-sm">
            <h2
              class="fantasy-font text-3xl font-bold text-fantasy-gold mb-6 text-center"
            >
              üìú ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠/‡∏Ç‡∏≤‡∏¢‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
            </h2>
            <div class="content-font text-lg space-y-6">
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold text-fantasy-gold mb-4">
                  üõí ‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö Mundane
                </h3>
                <ul class="space-y-2 text-gray-300">
                  <li>
                    ‚Ä¢ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Å‡∏£‡∏≤‡∏∞, ‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò,
                    ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢ (Adventuring Gear) ‡πÉ‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏ß‡πâ‡πÉ‡∏ô
                    Player's Handbook 2014 ‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ô‡∏∂‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏°
                  </li>
                  <li>
                    ‚Ä¢ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠/‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô Tracking Sheet
                    ‡πÅ‡∏•‡∏∞‡πÉ‡∏ô‡∏î‡∏¥‡∏™‡∏Ñ‡∏≠‡∏£‡πå‡∏ó
                  </li>
                  <li>
                    ‚Ä¢ ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏∞‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å ‡πÄ‡∏ä‡πà‡∏ô Mundane Item, Tattoo,
                    Manual, ‡πÅ‡∏•‡∏∞ Misc
                  </li>
                  <li>
                    ‚Ä¢ ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ
                    ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                    ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÑ‡∏î‡πâ‡πÉ‡∏ô Crafting Only Item
                  </li>
                </ul>
              </div>
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold text-fantasy-gold mb-4">
                  üí∞ ‡∏ã‡∏∑‡πâ‡∏≠/‡∏Ç‡∏≤‡∏¢ Magic Item
                </h3>
                <ul class="space-y-2 text-gray-300">
                  <li>
                    ‚Ä¢ DM ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô Session
                    ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ
                    ‡∏ï‡∏≤‡∏° Tier
                  </li>
                  <li>
                    ‚Ä¢ ‡πÄ‡∏°‡∏∑‡πà‡∏≠ DM ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô Session
                    ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ
                    DM ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô
                  </li>
                  <li>‚Ä¢ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÑ‡∏î‡πâ 2 ‡∏ß‡∏¥‡∏ò‡∏µ</li>
                  <li>
                    1. ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Session ‡∏ñ‡πâ‡∏≤ DM ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
                    ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡πÅ‡∏ä‡πÅ‡∏ô‡∏•
                    waters-gate-marketplace
                  </li>
                  <li>
                    2. ‡∏ô‡∏≠‡∏Å Session
                    ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏•‡πÄ‡∏û‡∏•‡∏¢‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                    ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡πÅ‡∏ä‡πÅ‡∏ô‡∏•
                    waters-gate-marketplace
                  </li>
                  <li>
                    ‚Ä¢ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡πÉ‡∏ô‡πÅ‡∏ä‡πÅ‡∏ô‡∏•‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ô‡πâ‡∏≥
                    ‡πÅ‡∏ä‡πÅ‡∏ô‡∏•‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ô‡πâ‡∏≥‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î slowmode ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ
                    ‡∏ñ‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                    ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏¢‡∏±‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ã‡∏∑‡πâ‡∏≠/‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î
                  </li>
                </ul>
              </div>
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold text-fantasy-gold mb-4">
                  ‚öíÔ∏è ‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
                </h3>
                <ul class="space-y-2 text-gray-300">
                  <li>
                    ‚Ä¢ ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÑ‡∏î‡πâ‡∏°‡∏µ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á +1 Weapon,
                    +1 Armor, Generic Variant, ‡∏´‡∏£‡∏∑‡∏≠ Vestige of Divergence
                    ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÑ‡∏î‡πâ ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
                  </li>
                  <li>
                    - +1 Item -
                    ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏Ñ‡πà‡∏Ñ‡πà‡∏≤‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò‡∏ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏°‡∏µ‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
                    ‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡πÑ‡∏≠‡πÄ‡∏ó‡∏° Longsword ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏á 450gp
                    ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏õ‡πá‡∏ô +1 Longsword ‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢ 15gp
                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Longsword
                  </li>
                  <li>
                    - Generic Variant -
                    ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏ô‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö
                    +1 item
                  </li>
                  <li>
                    - Vestige of Divergence -
                    ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á !craft ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÅ‡∏ä‡πÅ‡∏ô‡∏•
                    crafting ‡πÉ‡∏ô‡∏î‡∏¥‡∏™‡∏Ñ‡∏≠‡∏£‡πå‡∏ó
                    ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
                  </li>
                  <li>
                    *‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô +1 item ‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô Generic Variant ‡πÑ‡∏î‡πâ
                    ‡πÅ‡∏•‡∏∞‡πÑ‡∏≠‡πÄ‡∏ó‡∏° Generic Variant ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô +1 Item ‡πÑ‡∏î‡πâ
                  </li>
                  <li>
                    **‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏à‡∏≤‡∏Å +1 item ‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô +2 item
                    ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏Ñ‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á ‡πÄ‡∏ä‡πà‡∏ô
                    ‡∏ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏à‡∏≤‡∏Å +1 Dagger ‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô +2 Dagger
                    ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡πà‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á 450gp ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÑ‡∏î‡πâ
                    ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Dagger ‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö +1 Item
                    ‡∏Ñ‡∏∑‡∏≠ ‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏á 900gp ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò‡πÄ‡∏û‡∏¥‡πà‡∏°
                    (+3 item ‡∏Å‡πá‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Gemstone Page -->
        <div id="gemstonePage" class="page-content hidden">
          <div class="bg-black bg-opacity-50 rounded-xl p-8 backdrop-blur-sm">
            <h2
              class="fantasy-font text-3xl font-bold text-fantasy-gold mb-6 text-center"
            >
              üíé ‡∏Å‡∏è‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ Gemstone
            </h2>
            <div class="content-font text-lg space-y-6">
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold text-fantasy-gold mb-4">
                  üíé ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Gemstone (DMG, p.134)
                </h3>
                <div class="grid md:grid-cols-3 gap-x-0 gap-y-4">
                  <div>
                    <h4 class="font-bold text-green-400 mb-2">‡∏ä‡∏∑‡πà‡∏≠</h4>
                    <ul class="text-gray-300 space-y-1">
                      <li>‚Ä¢ 10 gp Gemstones</li>
                      <li>‚Ä¢ 50 gp Gemstones</li>
                      <li>‚Ä¢ 100 gp Gemstones</li>
                      <li>‚Ä¢ 500 gp Gemstones</li>
                      <li>‚Ä¢ 1,000 gp Gemstones</li>
                      <li>‚Ä¢ 5,000 gp Gemstones</li>
                    </ul>
                  </div>
                  <div>
                    <h4 class="font-bold text-orange-400 mb-2">Tier</h4>
                    <ul class="text-gray-300 space-y-1">
                      <li>Tier 0</li>
                      <li>Tier 1</li>
                      <li>Tier 1</li>
                      <li>Tier 1</li>
                      <li>Tier 2</li>
                      <li>Tier 2</li>
                    </ul>
                  </div>
                  <div>
                    <h4 class="font-bold text-blue-400 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤</h4>
                    <ul class="text-gray-300 space-y-1">
                      <li>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ôx1</li>
                      <li>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ôx1.1</li>
                      <li>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ôx1.25</li>
                      <li>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ôx1.5</li>
                      <li>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ôx1.75</li>
                      <li>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ôx2</li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold text-fantasy-gold mb-4">
                  üìã ‡∏Å‡∏è‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢
                </h3>
                <ul class="space-y-2 text-gray-300">
                  <li>
                    1. ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ Gemstone
                    ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≤‡∏á DM ‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Reward Action
                    Surge (‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• DM x2) ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡πÇ‡∏î‡∏¢‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏∞‡∏°‡∏µ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ 24
                    ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡πà‡∏ô
                  </li>
                  <li>
                    2. ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≠‡∏á Gemstone ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á Gemstone ‡∏ô‡∏±‡πâ‡∏ô‡πÜ
                    ‡πÇ‡∏î‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏∞‡∏ã‡∏∑‡πâ‡∏≠ Gemstone ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏£‡∏ó‡∏Ç‡∏≠‡∏á
                    Gemstone ‡∏ô‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡∏ã‡∏∑‡πâ‡∏≠ Opal 200gp worth
                    ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏á 200x1.75=350gp
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Mundane Page -->
        <div id="mundanePage" class="page-content hidden">
          <div class="bg-black bg-opacity-50 rounded-xl p-8 backdrop-blur-sm">
            <h2
              class="fantasy-font text-3xl font-bold text-fantasy-gold mb-6 text-center"
            >
              üíÄ ‡∏Å‡∏è‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏¢‡∏≤‡∏û‡∏¥‡∏©
            </h2>
            <div class="content-font text-lg space-y-6">
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold text-fantasy-gold mb-4">
                  üìã ‡∏Å‡∏è‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡∏≤‡∏û‡∏¥‡∏©‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏≤‡∏û‡∏¥‡∏© (PHB,
                  p.258)
                </h3>
                <ul class="space-y-2 text-gray-300">
                  <li>
                    ‚Ä¢ ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Å‡∏è‡∏à‡∏≤‡∏Å Player's Handbook (PHB)
                    ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡∏≤‡∏û‡∏¥‡∏©‡∏ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏°‡∏µ Proficiency ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Poisoner's
                    Kit
                    ‡πÇ‡∏î‡∏¢‡∏¢‡∏≤‡∏û‡∏¥‡∏©‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ö‡∏≤‡∏á‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏û‡∏¥‡πÄ‡∏®‡∏©
                    ‡πÄ‡∏ä‡πà‡∏ô Wyvern Poision
                  </li>
                  <li>
                    ‚Ä¢ ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏à‡∏≤‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏°‡∏µ‡∏û‡∏¥‡∏©‡πÑ‡∏î‡πâ
                    ‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏°‡∏î‡∏™‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤
                    1d6 ‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡∏∞ DC 20 Intelligence (Nature) Check ‡∏´‡∏£‡∏∑‡∏≠
                    Poisoner's Kit Check
                  </li>
                  <li>
                    ‚Ä¢ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏°‡∏µ Proficiency ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡∏≤‡∏û‡∏¥‡∏©‡πÑ‡∏î‡πâ 1 ‡∏≠‡∏±‡∏ô
                    ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö
                    ‡πÅ‡∏•‡∏∞‡∏ñ‡πâ‡∏≤‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 5 ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤
                    ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏û‡∏¥‡∏©‡πÅ‡∏ó‡∏ô
                  </li>
                </ul>
              </div>
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold text-fantasy-gold mb-4">
                  üìã ‡∏Å‡∏è‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏û‡∏¥‡∏©
                </h3>
                <ul class="space-y-2 text-gray-300">
                  <li>
                    ‚Ä¢ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ Action ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏û‡∏¥‡∏©‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Injury
                    ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò, ‡∏•‡∏π‡∏Å‡∏ò‡∏ô‡∏π, ‡∏Å‡∏£‡∏∞‡∏™‡∏∏‡∏ô,
                    ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ
                  </li>
                  <li>
                    ‚Ä¢ ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Ammunition ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏¢‡∏≤‡∏û‡∏¥‡∏©‡πÑ‡∏î‡πâ 3 ‡∏≠‡∏±‡∏ô‡∏ï‡πà‡∏≠‡∏¢‡∏≤‡∏û‡∏¥‡∏©
                    1 ‡∏≠‡∏±‡∏ô ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏¢‡∏≤‡∏û‡∏¥‡∏©‡∏à‡∏∞‡∏°‡∏µ‡∏ú‡∏•‡∏≠‡∏¢‡∏π‡πà 1 ‡∏ô‡∏≤‡∏ó‡∏µ
                  </li>
                  <li>
                    ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÑ‡∏°‡πà‡∏°‡∏µ Poisoner's Kit Proficiency
                    ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏¢‡∏≤‡∏û‡∏¥‡∏©‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== Cart Page ===== -->
        <section id="cartPage" class="page-content hidden">
          <div class="container mx-auto px-4 py-10">
            <h2 class="text-2xl md:text-3xl font-bold text-fantasy-gold mb-6">
              üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            </h2>

            <div id="cartEmpty" class="text-gray-400">
              ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
            </div>

            <div
              id="cartTable"
              class="hidden bg-gray-800/60 rounded-lg overflow-hidden"
            >
              <table class="w-full text-sm">
                <thead class="bg-gray-900/60">
                  <tr>
                    <th class="text-left px-4 py-3 w-2/5">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                    <th class="text-left px-4 py-3">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</th>
                    <th class="text-right px-4 py-3 whitespace-nowrap">
                      ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô
                    </th>
                    <th class="text-center px-4 py-3">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                    <th class="text-right px-4 py-3">‡∏£‡∏ß‡∏°</th>
                    <th class="px-2 py-3 w-12"></th>
                  </tr>
                </thead>
                <tbody id="cartBody"></tbody>
              </table>
            </div>

            <div
              id="cartFooter"
              class="hidden mt-4 flex items-center justify-between"
            >
              <div class="text-lg">
                ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:
                <span
                  id="cartTotal"
                  class="font-bold text-fantasy-gold tabular-nums"
                  >0</span
                >
                gp
              </div>
              <div class="flex gap-2">
                <button
                  id="copyCartEmbedBtn"
                  class="bg-fantasy-gold text-black px-4 py-2 rounded font-bold hover:bg-yellow-400"
                >
                  ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÉ‡∏ö‡∏ã‡∏∑‡πâ‡∏≠
                </button>
                <button
                  id="clearCartBtn"
                  class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded font-semibold"
                >
                  ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Crafting Page -->
        <div id="craftingPage" class="page-content hidden">
          <div class="bg-black bg-opacity-50 rounded-xl p-8 backdrop-blur-sm">
            <h2
              class="fantasy-font text-3xl font-bold text-fantasy-gold mb-6 text-center"
            >
              üî® ‡∏Å‡∏è‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£ Crafting
            </h2>
            <div class="content-font text-lg space-y-6">
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold text-fantasy-gold mb-4">
                  ‚öíÔ∏è Crafing Rule
                </h3>
                <ul class="space-y-2 text-gray-300">
                  <li>
                    ‚Ä¢ ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ proficient
                    ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô Smith's Tools
                    ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏£‡∏≤‡∏∞
                  </li>
                  <li>
                    ‚Ä¢ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞ Favor ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á
                  </li>
                  <li>
                    ‚Ä¢ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á !craft
                    discard ‡πÅ‡∏ï‡πà‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô
                  </li>
                  <li>
                    ‚Ä¢ ‡πÑ‡∏≠‡πÄ‡∏ó‡∏° Artifact, ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö Legendary
                    ‡πÅ‡∏•‡∏∞‡∏ö‡∏≤‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÜ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                  </li>
                  <li>‚Ä¢ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏à‡∏≤‡∏Å‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÑ‡∏î‡πâ</li>
                  <li>
                    ‚Ä¢ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÑ‡∏î‡πâ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô
                    Spell, Class Feature, ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏ä‡πà‡∏ô
                    Prof. bonus, Guidance, Flash of Genius, etc
                  </li>
                </ul>
              </div>
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold text-fantasy-gold mb-4">
                  ü™ô Crafing Cost
                </h3>
                <ul class="space-y-2 text-gray-300">
                  <li>
                    ‚Ä¢ ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ô‡∏∂‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞ Favor
                    ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
                  </li>
                </ul>
                <div class="overflow-x-auto rounded-lg shadow-lg">
                  <table class="min-w-full text-sm text-white">
                    <thead>
                      <tr class="bg-orange-700">
                        <th
                          class="px-4 py-3 border border-orange-600 text-left font-bold"
                        >
                          Tier
                        </th>
                        <th
                          class="px-4 py-3 border border-orange-600 text-center font-bold"
                        >
                          ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á
                        </th>
                        <th
                          class="px-4 py-3 border border-orange-600 text-center font-bold"
                        >
                          ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ñ‡∏≤‡∏ß‡∏£
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="bg-orange-800 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Tier 0-1
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          6
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          12
                        </td>
                      </tr>
                      <tr class="bg-orange-900 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Tier 2
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          10
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          20
                        </td>
                      </tr>
                      <tr class="bg-orange-800 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Tier 3
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          20
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          40
                        </td>
                      </tr>
                      <tr class="bg-orange-900 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Tier 4
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          30
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          60
                        </td>
                      </tr>
                      <tr class="bg-orange-800 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Tier 5
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          40
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          80
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold text-fantasy-gold mb-4">
                  üí° Crafting DC Table:
                </h3>
                <div class="overflow-x-auto rounded-lg shadow-lg">
                  <table class="min-w-full text-sm text-white">
                    <thead>
                      <tr class="bg-orange-700">
                        <th
                          class="px-4 py-3 border border-orange-600 text-left font-bold"
                        >
                          Tier
                        </th>
                        <th
                          class="px-4 py-3 border border-orange-600 text-center font-bold"
                        >
                          ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á
                        </th>
                        <th
                          class="px-4 py-3 border border-orange-600 text-center font-bold"
                        >
                          ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Check
                        </th>
                        <th
                          class="px-4 py-3 border border-orange-600 text-center font-bold"
                        >
                          ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ñ‡∏≤‡∏ß‡∏£
                        </th>
                        <th
                          class="px-4 py-3 border border-orange-600 text-center font-bold"
                        >
                          ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Check
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="bg-orange-800 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Tier 0-1
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          12
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          1
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          14
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          4
                        </td>
                      </tr>
                      <tr class="bg-orange-900 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Tier 2
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          14
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          4
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          16
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          8
                        </td>
                      </tr>
                      <tr class="bg-orange-800 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Tier 3
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          20
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          10
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          22
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          20
                        </td>
                      </tr>
                      <tr class="bg-orange-900 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Tier 4
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          22
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          20
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          26
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          40
                        </td>
                      </tr>
                      <tr class="bg-orange-800 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Tier 5
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          25
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          30
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          28
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          50
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <!-- üßÆ Crafting Calculator -->
              <div class="bg-gray-800 rounded-lg p-6 mt-6">
                <h3 class="text-xl font-bold text-fantasy-gold mb-4">
                  üßÆ Crafting Calculator
                </h3>

                <div class="grid md:grid-cols-4 gap-4">
                  <select
                    id="craftTier"
                    class="p-2 rounded bg-gray-700 text-white"
                  >
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Tier</option>
                    <option value="Tier 0">Tier 0</option>
                    <option value="Tier 1">Tier 1</option>
                    <option value="Tier 2">Tier 2</option>
                    <option value="Tier 3">Tier 3</option>
                    <option value="Tier 4">Tier 4</option>
                    <option value="Tier 5">Tier 5</option>
                  </select>

                  <select
                    id="craftType"
                    class="p-2 rounded bg-gray-700 text-white"
                  >
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                    <option value="‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á">‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á</option>
                    <option value="‡∏ñ‡∏≤‡∏ß‡∏£">‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ñ‡∏≤‡∏ß‡∏£</option>
                  </select>

                  <input
                    id="craftPrice"
                    type="number"
                    min="0"
                    step="1"
                    placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡πÑ‡∏≠‡πÄ‡∏ó‡∏° (gp)"
                    class="p-2 rounded bg-gray-700 text-white"
                  />

                  <button
                    id="craftReset"
                    class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded"
                  >
                    ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤
                  </button>
                </div>

                <div class="grid md:grid-cols-4 gap-4 mt-5 text-gray-200">
                  <div class="bg-gray-900 rounded p-3">
                    <div class="text-sm text-gray-400">Favor ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ</div>
                    <div id="outFavor" class="text-2xl font-bold">‚Äî</div>
                  </div>
                  <div class="bg-gray-900 rounded p-3">
                    <div class="text-sm text-gray-400">DC</div>
                    <div id="outDC" class="text-2xl font-bold">‚Äî</div>
                  </div>
                  <div class="bg-gray-900 rounded p-3">
                    <div class="text-sm text-gray-400">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Check</div>
                    <div id="outChecks" class="text-2xl font-bold">‚Äî</div>
                  </div>
                  <div class="bg-gray-900 rounded p-3">
                    <div class="text-sm text-gray-400">
                      ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏≠‡∏á (‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á)
                    </div>
                    <div id="outGold" class="text-2xl font-bold">‚Äî</div>
                  </div>
                </div>

                <p class="text-xs text-gray-400 mt-3">
                  * ‡∏ó‡∏≠‡∏á = ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å | ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Favor
                  ‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å Crafing Cost | DC ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å Crafting DC Table
                </p>
              </div>
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold text-fantasy-gold mb-4">
                  üî® Tool Proficiencies Needed
                </h3>
                <ul class="space-y-2 text-gray-300">
                  <li>
                    ‚Ä¢ ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏° ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ proficiency
                    ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
                    ‡πÇ‡∏î‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
                  </li>
                </ul>
                <div class="overflow-x-auto rounded-lg shadow-lg">
                  <table class="min-w-full text-sm text-white">
                    <thead>
                      <tr class="bg-orange-700">
                        <th
                          class="px-4 py-3 border border-orange-600 text-left font-bold"
                        >
                          ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
                        </th>
                        <th
                          class="px-4 py-3 border border-orange-600 text-left font-bold"
                        >
                          Tool Proficiencies
                        </th>
                        <th
                          class="px-4 py-3 border border-orange-600 text-left font-bold"
                        >
                          Stats ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ
                        </th>
                      </tr>
                    </thead>
                    <tbody class="[&>tr>td]:align-top">
                      <tr class="bg-orange-800 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Armor
                        </td>
                        <td
                          class="px-4 py-2 border border-orange-700 break-words"
                        >
                          Cobbler's, Leatherworker's, Smith's, Tinker's,
                          Weaver's
                        </td>
                        <td class="px-4 py-2 border border-orange-700">
                          STR / DEX
                        </td>
                      </tr>
                      <tr class="bg-orange-900 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Adventure Gear
                        </td>
                        <td
                          class="px-4 py-2 border border-orange-700 break-words"
                        >
                          Carpenter's, Leatherworker's, Smith's, Tinker's
                        </td>
                        <td class="px-4 py-2 border border-orange-700">
                          INT / WIS
                        </td>
                      </tr>
                      <tr class="bg-orange-800 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Ammunition
                        </td>
                        <td
                          class="px-4 py-2 border border-orange-700 break-words"
                        >
                          Smith's, Tinker's, Woodcarver's
                        </td>
                        <td class="px-4 py-2 border border-orange-700">
                          DEX / WIS
                        </td>
                      </tr>
                      <tr class="bg-orange-900 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Potion / Poison
                        </td>
                        <td
                          class="px-4 py-2 border border-orange-700 break-words"
                        >
                          Alchemist's, Brewer's, Herbalist's, Poisoner's
                        </td>
                        <td class="px-4 py-2 border border-orange-700">
                          CON / WIS
                        </td>
                      </tr>
                      <tr class="bg-orange-800 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">Ring</td>
                        <td
                          class="px-4 py-2 border border-orange-700 break-words"
                        >
                          Glassblower's, Jeweler's, Tinker's
                        </td>
                        <td class="px-4 py-2 border border-orange-700">
                          DEX / CHA
                        </td>
                      </tr>
                      <tr class="bg-orange-900 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Scroll
                        </td>
                        <td
                          class="px-4 py-2 border border-orange-700 break-words"
                        >
                          Calligrapher's, Forgery
                        </td>
                        <td class="px-4 py-2 border border-orange-700">
                          DEX / INT
                        </td>
                      </tr>
                      <tr class="bg-orange-800 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Shield
                        </td>
                        <td
                          class="px-4 py-2 border border-orange-700 break-words"
                        >
                          Carpenter's, Smith's, Woodcarver's
                        </td>
                        <td class="px-4 py-2 border border-orange-700">
                          STR / CON
                        </td>
                      </tr>
                      <tr class="bg-orange-900 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Wand | Rod
                        </td>
                        <td
                          class="px-4 py-2 border border-orange-700 break-words"
                        >
                          Tinker's, Woodcarver's
                        </td>
                        <td class="px-4 py-2 border border-orange-700">
                          INT / WIS / CHA
                        </td>
                      </tr>
                      <tr class="bg-orange-800 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Weapon
                        </td>
                        <td
                          class="px-4 py-2 border border-orange-700 break-words"
                        >
                          Smith's, Tinker's, Woodcarver's
                        </td>
                        <td class="px-4 py-2 border border-orange-700">
                          STR / DEX / CON
                        </td>
                      </tr>
                      <tr class="bg-orange-900 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Wondrous Item
                        </td>
                        <td
                          class="px-4 py-2 border border-orange-700 break-words"
                        >
                          Any applicable tool
                        </td>
                        <td class="px-4 py-2 border border-orange-700">
                          INT / CHA
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-bold text-fantasy-gold mb-4">
                  üè™ Exalting Vestige of Divergence Magic Item
                </h3>
                <ul class="space-y-2 text-gray-300">
                  <li>
                    ‚Ä¢ ‡πÑ‡∏≠‡πÄ‡∏ó‡∏° Vestige of Divergence ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
                    !craft ‡πÇ‡∏î‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏à‡∏∞‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô check ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Favor
                    ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏ï‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö DC ‡∏à‡∏∞‡∏¢‡∏±‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡∏Å‡∏©‡∏∞
                    Arcana ‡∏´‡∏£‡∏∑‡∏≠ Religion ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                  </li>
                  <li>
                    ‚Ä¢
                    ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏à‡∏≤‡∏Å‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏ï‡πà‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô
                    Spell, Class Feature, ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô Prof.
                    bonus, Guidance, Flash of Genius, etc ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
                  </li>
                  <li>
                    ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: !craft vod awakened "Circlet of Barbed
                    Vision" arcana
                  </li>
                </ul>
                <div class="overflow-x-auto rounded-lg shadow-lg">
                  <table class="min-w-full text-sm text-white">
                    <thead>
                      <tr class="bg-orange-700">
                        <th
                          class="px-4 py-3 border border-orange-600 text-left font-bold"
                        >
                          &nbsp;
                        </th>
                        <th
                          class="px-4 py-3 border border-orange-600 text-center font-bold"
                        >
                          DC
                        </th>
                        <th
                          class="px-4 py-3 border border-orange-600 text-center font-bold"
                        >
                          ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Check
                        </th>
                        <th
                          class="px-4 py-3 border border-orange-600 text-center font-bold"
                        >
                          Favor ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="bg-orange-800 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Dormant
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          0
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          0
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          0
                        </td>
                      </tr>
                      <tr class="bg-orange-900 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Awakened
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          20
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          20
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          50
                        </td>
                      </tr>
                      <tr class="bg-orange-800 hover:bg-orange-700/80">
                        <td class="px-4 py-2 border border-orange-700">
                          Exalted
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          20
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          50
                        </td>
                        <td
                          class="px-4 py-2 text-center border border-orange-700"
                        >
                          100
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Items Page -->
        <div id="itemsPage" class="page-content hidden">
          <div class="bg-black bg-opacity-50 rounded-xl p-4 backdrop-blur-sm">
            <h2
              class="fantasy-font text-3xl font-bold text-fantasy-gold mb-6 text-center"
            >
              ‚öîÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            </h2>
            <p class="text-gray-300 mb-4 text-center">
              * ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏Ç‡∏≤‡∏¢‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
              ‡∏ó‡∏∏‡∏Å‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ô‡∏∂‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô<br />
              * ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÅ‡∏ö‡∏ö
              Homebrew<br />
              * ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏î‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà
              <a class="text-fantasy-gold">Staff</a>
            </p>
            <!-- Filters -->
            <div class="mb-6 grid md:grid-cols-4 gap-4">
              <select
                id="tierFilter"
                class="p-2 rounded bg-gray-700 text-white"
              >
                <option value="">‡∏ó‡∏∏‡∏Å Tier</option>
                <option value="Tier 0">Tier 0</option>
                <option value="Tier 1">Tier 1</option>
                <option value="Tier 2">Tier 2</option>
                <option value="Tier 3">Tier 3</option>
                <option value="Tier 4">Tier 4</option>
                <option value="Tier 5">Tier 5</option>
                <option value="Mundane Item">Mundane Item</option>
              </select>
              <select
                id="rarityFilter"
                class="p-2 rounded bg-gray-700 text-white"
              >
                <option value="">‡∏ó‡∏∏‡∏Å Rarity</option>
                <option value="Common">Common</option>
                <option value="Uncommon">Uncommon</option>
                <option value="Rare">Rare</option>
                <option value="Very Rare">Very Rare</option>
                <option value="Legendary">Legendary</option>
                <option value="Artifact">Artifact</option>
                <option value="Mundane">Mundane</option>
              </select>
              <select
                id="attuneFilter"
                class="p-2 rounded bg-gray-700 text-white"
              >
                <option value="">Attune</option>
                <option value="Yes">‡∏ï‡πâ‡∏≠‡∏á Attune</option>
                <option value="No">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á Attune</option>
              </select>
              <select
                id="PerDisFilter"
                class="p-2 rounded bg-gray-700 text-white"
              >
                <option value="">‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                <option value="‡∏ñ‡∏≤‡∏ß‡∏£">‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ñ‡∏≤‡∏ß‡∏£</option>
                <option value="‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á">‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á</option>
              </select>
              <select
                id="typeFilter"
                class="p-2 rounded bg-gray-700 text-white"
              >
                <option value="">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                <option value="Adventuring Gear">Adventuring Gear</option>
                <option value="Ammunition">Ammunition</option>
                <option value="Armor">Armor</option>
                <option value="Gemstone">Gemstone</option>
                <option value="Generic Variant">Generic Variant</option>
                <option value="Illegal Drug">Illegal Drug</option>
                <option value="Other">Other</option>
                <option value="Potion">Potion</option>
                <option value="Healing Potion">Healing Potion</option>
                <option value="Poison">Poison</option>
                <option value="Ring">Ring</option>
                <option value="Scroll">Scroll</option>
                <option value="Spell Components">Spell Components</option>
                <option value="Spell Scroll">Spell Scroll</option>
                <option value="Shield">Shield</option>
                <option value="Weapon,">Weapon</option>
                <option value="Rod">Weapon, Rod</option>
                <option value="Wand">Weapon, Wand</option>
                <option value="Wondrous Item">Wondrous Item</option>
                <option value="Wondrous item (Tattoo)">
                  Wondrous Item, Tattoo
                </option>
              </select>
              <input
                type="text"
                id="searchFilter"
                placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°..."
                class="p-2 rounded bg-gray-700 text-white"
              />
            </div>

            <!-- Bulk actions -->
            <div id="bulkActions" class="flex items-center gap-3 mt-3">
              <label
                class="inline-flex items-center gap-2 text-sm text-gray-300"
              >
                <input
                  id="selectAllTop"
                  type="checkbox"
                  class="w-4 h-4 rounded bg-gray-700 border-gray-600"
                />
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
              </label>

              <button
                id="copySelectedBtn"
                class="bg-fantasy-gold text-black px-3 py-2 rounded font-bold hover:bg-yellow-400 disabled:opacity-50 disabled:cursor-not-allowed"
                disabled
              >
                ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏õ Discord
              </button>

              <button
                id="clearSelectionBtn"
                class="bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded font-semibold"
              >
                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
              </button>

              <button
                id="addToCartBtn"
                class="bg-emerald-500 text-black px-3 py-2 rounded font-bold hover:bg-emerald-400 disabled:opacity-50 disabled:cursor-not-allowed"
                disabled
              >
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
              </button>

              <button
                class="nav-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg font-semibold transition-all hover:scale-105"
                data-page="cart"
              >
                üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                <span
                  id="cartBadge"
                  class="ml-1 text-xs bg-fantasy-gold text-black px-2 py-0.5 rounded hidden"
                  >0</span
                >
              </button>

              <span id="selectedCount" class="text-xs text-gray-400"
                >(0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span
              >

              <button id="dmShopBtn"
                class="bg-fantasy-purple ml-auto text-white px-3 py-2 rounded font-bold hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed">
                üè™ DM Shop Session
              </button>
            </div>

            <!-- Items List -->
            <div id="itemsList" class="scroll-container">
              <div class="text-center py-8">
                <div
                  class="animate-spin rounded-full h-12 w-12 border-b-2 border-fantasy-gold mx-auto mb-4"
                ></div>
                <p class="text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Updates Page -->
        <div id="updatesPage" class="page-content hidden">
          <div class="bg-black bg-opacity-50 rounded-xl p-8 backdrop-blur-sm">
            <h2
              class="fantasy-font text-3xl font-bold text-fantasy-gold mb-6 text-center"
            >
              üì∞ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
            </h2>
            <div id="updatesList" class="scroll-container">
              <div class="text-center py-8">
                <div
                  class="animate-spin rounded-full h-12 w-12 border-b-2 border-fantasy-gold mx-auto mb-4"
                ></div>
                <p class="text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-black bg-opacity-50 border-t border-fantasy-gold mt-12">
      <div class="container mx-auto px-4 py-6 text-center">
        <p class="text-gray-400 content-font">
          üè∞ The Spire Market - aKittyCatüêà
        </p>
      </div>
    </footer>

    <!-- Admin Login Modal -->
    <div
      id="adminModal"
      class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 flex items-center justify-center"
    >
      <div
        class="bg-gray-800 rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl border-2 border-fantasy-gold"
      >
        <h3
          class="fantasy-font text-2xl font-bold text-fantasy-gold mb-6 text-center"
        >
          üîê Admin Login
        </h3>
        <form id="adminLoginForm">
          <input
            type="password"
            id="adminPassword"
            placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Admin"
            class="w-full p-3 rounded bg-gray-700 text-white mb-4"
            required
          />
          <div class="flex gap-4">
            <button
              type="submit"
              class="flex-1 bg-fantasy-gold text-black py-2 rounded font-bold hover:bg-yellow-500 transition-colors"
            >
              ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
            </button>
            <button
              type="button"
              id="cancelAdmin"
              class="flex-1 bg-gray-600 text-white py-2 rounded font-bold hover:bg-gray-700 transition-colors"
            >
              ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Generic Variant Picker Modal -->
    <div id="gvModal" class="fixed inset-0 bg-black/70 hidden z-50">
      <div class="absolute inset-0 flex items-center justify-center p-4">
        <div
          class="bg-gray-800 w-full max-w-2xl rounded-xl border-2 border-fantasy-gold shadow-2xl"
        >
          <div
            class="px-5 py-4 border-b border-gray-700 flex items-center gap-3"
          >
            <h3
              class="fantasy-font text-xl font-bold text-fantasy-gold"
              id="gvTitle"
            >
              ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô
            </h3>
            <input
              id="gvSearch"
              type="text"
              placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..."
              class="ml-auto p-2 rounded bg-gray-700 text-white w-56"
            />
            <button
              id="gvClose"
              class="px-3 py-1 rounded bg-gray-700 hover:bg-gray-600"
            >
              ‡∏õ‡∏¥‡∏î
            </button>
          </div>
          <div class="max-h-[60vh] overflow-y-auto" id="gvList"></div>
          <div
            class="px-5 py-3 border-t border-gray-700 text-right text-gray-400 text-sm"
          >
            * ‡∏£‡∏≤‡∏Ñ‡∏≤ = ‡∏£‡∏≤‡∏Ñ‡∏≤ Generic Variant + ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô
          </div>
        </div>
      </div>
    </div>

    <!-- Gemstone Picker Modal -->
    <div id="gemModal" class="fixed inset-0 bg-black/70 hidden z-50">
      <div class="absolute inset-0 flex items-center justify-center p-4">
        <div
          class="bg-gray-800 w-full max-w-2xl rounded-xl border-2 border-fantasy-gold shadow-2xl"
        >
          <div
            class="px-5 py-4 border-b border-gray-700 flex items-center gap-3"
          >
            <h3
              class="fantasy-font text-xl font-bold text-fantasy-gold"
              id="gemTitle"
            >
              ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏ç‡∏°‡∏ì‡∏µ
            </h3>
            <input
              id="gemSearch"
              type="text"
              placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏±‡∏ç‡∏°‡∏ì‡∏µ..."
              class="ml-auto p-2 rounded bg-gray-700 text-white w-56"
            />
            <button
              id="gemClose"
              class="px-3 py-1 rounded bg-gray-700 hover:bg-gray-600"
            >
              ‡∏õ‡∏¥‡∏î
            </button>
          </div>
          <div class="px-5 py-2 text-sm text-gray-300 flex items-center gap-2">
            ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (worth):
            <input id="gemWorth" type="text"
                  value="100"
                  class="w-28 text-right bg-gray-700 text-white rounded px-2 py-1" />
            gp √ó ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏ß‡∏î
          </div>
          <div class="max-h-[60vh] overflow-y-auto" id="gemList"></div>
          <div
            class="px-5 py-3 border-t border-gray-700 text-right text-red-400 text-sm"
          >
            *‡πÉ‡∏™‡πà‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
          </div>
        </div>
      </div>
    </div>

    <!-- (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÅ‡∏ï‡πà‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ) ex:v=2025-08-27-1 ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç build-->
    <script src="./gv-allowed.js"></script>
    <script src="./gem-allowed.js"></script>
    <script src="./select-rules.js"></script>
    <script src="./cart.js"></script>
    <script src="./dm-shop.js"></script>
    <script>
      // === Configuration ===
      const GOOGLE_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbwqFqqB0SNWDls42z9mYMrixFLC8ZevuXvZDwBq8MISUha-mRtC-vFX9B81Gkvrble-/exec";

      // === Browser cache (SWR) ===
      const CACHE = {
        items: "spire.items.v1",
        updates: "spire.updates.v1",
      };
      const TTL = { items: 60_000, updates: 60_000 }; // 2 * 60_000 : 2 ‡∏ô‡∏≤‡∏ó‡∏µ

      const now = () => Date.now();

      function readCache(key) {
        try {
          const raw = localStorage.getItem(key);
          if (!raw) return null;
          const obj = JSON.parse(raw);
          if (!obj || !obj.data || !obj.exp) return null;
          if (obj.exp < now()) return null; // ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ -> ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ
          return obj.data;
        } catch {
          return null;
        }
      }

      function writeCache(key, data, ttlMs) {
        try {
          localStorage.setItem(
            key,
            JSON.stringify({ data, exp: now() + ttlMs })
          );
        } catch {}
      }

      async function fetchJSON(url, { signal } = {}) {
        const res = await fetch(url, { signal, cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const txt = await res.text();
        try {
          return JSON.parse(txt);
        } catch (e) {
          console.error("Non-JSON from server:", txt.slice(0, 200));
          throw e;
        }
      }

      // === Helper: ‡∏ï‡∏±‡∏î‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡∏≠‡∏á Google ===
      function unwrapGoogleRedirect(url) {
        if (!url) return "";
        try {
          const u = new URL(url);
          if (
            (u.hostname === "www.google.com" || u.hostname === "google.com") &&
            u.pathname === "/url"
          ) {
            const real = u.searchParams.get("q") || u.searchParams.get("url");
            return real || url;
          }
          return url;
        } catch {
          return url;
        }
      }

      // === Global state ===
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏ä‡∏ô‡∏¥‡∏î (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ type ‡∏≠‡∏¢‡πà‡∏≤‡∏á "Weapon,", "Weapon, Rod", ‡πÅ‡∏•‡∏∞ "Shield")
      function isWeapon(it) {
        return (
          /\bweapon\b/i.test(it.type || "") ||
          /\bwand\b/i.test(it.type || "") ||
          /\brod\b/i.test(it.type || "")
        );
      }
      function isArmor(it) {
        return /\barmor\b/i.test(it.type || "");
      }

      // ===== Generic Variant state =====
      const gvMap = new Map(); // itemId -> {kind:'weapon'|'armor', id, name, price}

      // ‡πÄ‡∏õ‡πá‡∏ô Generic Variant ‡πÑ‡∏´‡∏°? (type ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤)
      function isGenericVariant(it) {
        return /\bgeneric variant\b/i.test(it.type || "");
      }

      // ‡πÄ‡∏î‡∏≤ kind ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠ (‡∏ñ‡πâ‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ß‡πà‡∏≤ Armor/Shield ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô armor, ‡∏ô‡∏≠‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô weapon)
      function guessGVKind(it) {
        const n = it.name || "";
        if (/\barmor|shield\b/i.test(n)) return "armor";
        return "weapon";
      }

      // ‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏µ‡∏¢‡πå variant ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
      function getVariantKey(item) {
        const raw = String(item?.name || "").trim();
        const lower = raw.toLowerCase();

        // 1) ‡∏à‡∏±‡∏ö +N ‡πÄ‡∏ä‡πà‡∏ô "Weapon +2", "Armor+3", "Shield +1"
        const m = lower.match(/^(weapon|armor|shield)\s*\+(\d+)\b/);
        if (m) return `${m[1]}+${m[2]}`;

        // 2) ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô slug ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö GV_ALLOWED
        //    - ‡∏•‡∏ö apostrophe
        //    - ‡∏ö‡∏µ‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ +
        //    - ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡∏≠‡∏∑‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ '-'
        const slug = lower
          .replace(/['‚Äô]/g, "")
          .replace(/\s*\+\s*(\d+)/g, "+$1")
          .replace(/[^a-z0-9+]+/g, "-")
          .replace(/^-+|-+$/g, "");

        if (window.GV_ALLOWED && window.GV_ALLOWED[slug]) return slug;

        return null;
      }

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∏‡∏î base item ‡∏à‡∏≤‡∏Å currentItems (‡πÑ‡∏°‡πà‡∏¢‡∏¥‡∏á GAS)
      function getBaseCandidatesForVariant(item) {
        const key = getVariantKey(item);
        const all = (currentItems || []).filter((b) => !isGenericVariant(b));

        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ï‡∏≤‡∏°‡∏Ñ‡∏µ‡∏¢‡πå‡πÉ‡∏ô GV_ALLOWED ‚Üí ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏
        if (key && window.GV_ALLOWED && window.GV_ALLOWED[key]) {
          const spec = window.GV_ALLOWED[key];
          const allowed = spec.list; // Set(lowercase)
          return all
            .filter((b) => {
              // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏° weapon/armor ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á kind ‡∏Å‡πà‡∏≠‡∏ô
              const isW =
                /\bweapon\b/i.test(b.type || "") ||
                /\bwand|rod\b/i.test(b.type || "");
              const isA = /\barmor|shield\b/i.test(b.type || "");
              if (spec.kind === "weapon" && !isW) return false;
              if (spec.kind === "armor" && !isA) return false;
              // ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏±‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
              return allowed.has(String(b.name).toLowerCase());
            })
            .map((b) => ({
              id: b.id,
              name: b.name,
              price: Number(parsePrice(b.price)) || 0,
              resultName:
                typeof spec.makeName === "function"
                  ? spec.makeName(b.name)
                  : b.name,
            }))
            .sort((a, b) => a.name.localeCompare(b.name));
        }

        // fallback: ‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
        const kind = guessGVKind(item);
        const isW = (t) =>
          /\bweapon\b/i.test(t || "") || /\bwand|rod\b/i.test(t || "");
        const isA = (t) => /\barmor|shield\b/i.test(t || "");
        return all
          .filter((b) => (kind === "weapon" ? isW(b.type) : isA(b.type)))
          .map((b) => ({
            id: b.id,
            name: b.name,
            price: Number(parsePrice(b.price)) || 0,
            resultName: b.name,
          }))
          .sort((a, b) => a.name.localeCompare(b.name));
      }

      // ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡∏Ç‡∏≠‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏° Generic Variant (‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å)
      function getGVAddon(it) {
        if (!isGenericVariant(it)) return null;
        const s = gvMap.get(it.id);
        return s ? { name: s.name, price: s.price } : null;
      }

      // ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠
      function escapeHtml(str = "") {
        return String(str)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏°‡πâ‡∏Å‡∏£‡∏≠‡∏á/‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà)
      const selectedIds = new Set();

      // UI ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ö bulk actions (‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô & ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°)
      function updateBulkActionsUI() {
        const txt = document.getElementById("selectedCount");
        if (txt) txt.textContent = `(${selectedIds.size} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`;
        const btn = document.getElementById("copySelectedBtn");
        if (btn) btn.disabled = selectedIds.size === 0;

        const addBtn = document.getElementById("addToCartBtn");
        if (addBtn) addBtn.disabled = selectedIds.size === 0;
      }

      function parsePrice(s) {
        const n = Number(String(s || "").replace(/[^0-9.]/g, ""));
        return isFinite(n) ? n : 0;
      }
      function fmt(n) {
        return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      }
      function formatDiscordItems(items) {
        const lines = items.map((it) => {
          // ‡∏ê‡∏≤‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å price ‡∏õ‡∏Å‡∏ï‡∏¥
          let basePrice = parsePrice(it.price);

          // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Gemstone ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏ç‡∏°‡∏ì‡∏µ‡πÑ‡∏ß‡πâ ‡πÉ‡∏´‡πâ override ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏±‡∏ç‡∏°‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å modal
          const gem = isGemstone(it) ? getGemAddon(it) : null;
          if (gem) basePrice = gem.final;

          // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Generic Variant base item ‡∏Å‡πá + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
          const gv = getGVAddon ? getGVAddon(it) : null; // ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
          const tagGV = gv ? ` [Base: ${gv.name}]` : "";
          const tagGem = gem
            ? ` [${gem.name} ${fmt(gem.worth)} gp worth √ó ${gem.factor.toFixed(2)}] = ${fmt(gem.final)} gp`
            : "";

          const priceTxt =
            `${fmt(basePrice)} gp` +
            (gv && gv.price ? ` (+${fmt(gv.price)})` : "");

          return `- ${it.name}${tagGem}${tagGV} | ${priceTxt}`;
        });

        const total = items.reduce((sum, it) => {
          let base = parsePrice(it.price);
          const gem = isGemstone(it) ? getGemAddon(it) : null;
          if (gem) base = gem.final;
          const gv = getGVAddon ? getGVAddon(it)?.price || 0 : 0;
          return sum + base + gv;
        }, 0);

        const header = `‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (${items.length} ‡∏ä‡∏¥‡πâ‡∏ô)`;
        const footer = `‚Äî ‡∏£‡∏ß‡∏°: ${fmt(total)} gp`;
        return (
          "```md\n" + header + "\n" + lines.join("\n") + "\n" + footer + "\n```"
        );
      }

      let currentItems = [];
      let currentUpdates = [];
      let isAdminMode = false;
      let adminToken = null; // <--- ‡πÇ‡∏ó‡πÄ‡∏Ñ‡πá‡∏ô‡∏à‡∏≤‡∏Å GAS ‡∏´‡∏•‡∏±‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô

      // === DOM Elements ===
      const navButtons = document.querySelectorAll(".nav-btn");
      const pageContents = document.querySelectorAll(".page-content");
      const adminPanel = document.getElementById("adminPanel");
      const adminToggle = document.getElementById("adminToggle");
      const adminModal = document.getElementById("adminModal");

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        setupEventListeners();
        loadData();
      });

      function setupEventListeners() {
        document
          .getElementById("copySelectedBtn")
          .addEventListener("click", async () => {
            const items = currentItems.filter((it) => selectedIds.has(it.id));
            const text = formatDiscordItems(items);
            await navigator.clipboard.writeText(text);
            const btn = document.getElementById("copySelectedBtn");
            const old = btn.textContent;
            btn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úì";
            setTimeout(() => (btn.textContent = old), 1500);
          });

        document
          .getElementById("addToCartBtn")
          .addEventListener("click", () => {
            const ids = Array.from(selectedIds);
            if (!ids.length) return;

            if (!window.CART || typeof window.CART.addSelected !== "function") {
              console.warn("CART API not loaded");
              alert("‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
              return;
            }
            window.CART.addSelected(ids);
          });

        document.getElementById("itemsList").addEventListener("click", (e) => {
          const btn = e.target.closest(".add-cart-btn"); // ‡πÅ‡∏Å‡πâ selector ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏õ‡∏∏‡πà‡∏°
          if (!btn) return;
          e.preventDefault();
          e.stopPropagation(); // ‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏õ‡∏ó‡∏£‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ñ‡∏ß

          const id = btn.dataset.addId;
          if (window.CART && typeof window.CART.addSelected === "function") {
            window.CART.addSelected([id]);
          } else {
            console.warn("CART not ready");
          }
        });

        document
          .getElementById("clearSelectionBtn")
          .addEventListener("click", () => {
            // ‡∏•‡πâ‡∏≤‡∏á‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            selectedIds.clear();

            // ‡∏õ‡∏•‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏µ‡πà "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡∏ó‡∏±‡πâ‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            const top = document.getElementById("selectAllTop");
            if (top) top.checked = false;
            const head = document.querySelector("#itemsList #selectAll");
            if (head) head.checked = false;

            // ‡∏õ‡∏•‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå
            document
              .querySelectorAll("#itemsList .row-select:not(:disabled)")
              .forEach((cb) => {
                cb.checked = false;
                const row = cb.closest("tr[data-row-index]");
                if (row)
                  row.classList.remove(
                    "ring-1",
                    "ring-fantasy-gold",
                    "bg-gray-700/40"
                  );
              });

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ñ‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ (‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö/‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å)
            updateBulkActionsUI();
          });

        // Navigation
        navButtons.forEach((btn) => {
          btn.addEventListener("click", () => switchPage(btn.dataset.page));
        });

        // Admin toggle
        adminToggle.addEventListener("click", showAdminLogin);

        // Admin login
        document
          .getElementById("adminLoginForm")
          .addEventListener("submit", handleAdminLogin);
        document
          .getElementById("cancelAdmin")
          .addEventListener("click", hideAdminLogin);

        // Forms
        document
          .getElementById("itemForm")
          .addEventListener("submit", handleItemSubmit);
        document
          .getElementById("updateForm")
          .addEventListener("submit", handleUpdateSubmit);

        // Cancel edit buttons
        document
          .getElementById("itemCancelEdit")
          .addEventListener("click", clearItemForm);
        document
          .getElementById("updateCancelEdit")
          .addEventListener("click", clearUpdateForm);

        // Filters
        document
          .getElementById("tierFilter")
          .addEventListener("change", filterItems);
        document
          .getElementById("rarityFilter")
          .addEventListener("change", filterItems);
        document
          .getElementById("attuneFilter")
          .addEventListener("change", filterItems);
        document
          .getElementById("PerDisFilter")
          .addEventListener("change", filterItems);
        document
          .getElementById("typeFilter")
          .addEventListener("change", filterItems);
        document
          .getElementById("searchFilter")
          .addEventListener("input", filterItems);

        // Close modal on outside click
        adminModal.addEventListener("click", (e) => {
          if (e.target === adminModal) hideAdminLogin();
        });
      }

      function switchPage(pageId) {
        // Update navigation
        navButtons.forEach((btn) => {
          btn.classList.remove("active", "bg-fantasy-gold", "text-black");
          btn.classList.add("bg-gray-700", "hover:bg-gray-600");
        });

        const activeBtn = document.querySelector(`[data-page="${pageId}"]`);
        activeBtn.classList.add("active", "bg-fantasy-gold", "text-black");
        activeBtn.classList.remove("bg-gray-700", "hover:bg-gray-600");

        // Update content
        pageContents.forEach((page) => page.classList.add("hidden"));
        document.getElementById(`${pageId}Page`).classList.remove("hidden");

        // Load data if needed
        if (pageId === "items" && currentItems.length === 0) {
          loadItems();
        } else if (pageId === "updates" && currentUpdates.length === 0) {
          loadUpdates();
        }
      }

      function showAdminLogin() {
        if (isAdminMode) {
          // Toggle off admin mode
          isAdminMode = false;
          adminToken = null; // ‡∏•‡πâ‡∏≤‡∏á‡πÇ‡∏ó‡πÄ‡∏Ñ‡πá‡∏ô
          adminPanel.classList.remove("active");
          adminToggle.textContent = "Admin Panel";
          adminToggle.classList.remove("bg-fantasy-red");
          adminToggle.classList.add("bg-fantasy-purple");
          refreshAdminUI(); // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
        } else {
          // Show login modal
          adminModal.classList.remove("hidden");
          document.getElementById("adminPassword").focus();
        }
      }

      function hideAdminLogin() {
        adminModal.classList.add("hidden");
        document.getElementById("adminPassword").value = "";
      }

      async function handleAdminLogin(e) {
        e.preventDefault();
        const password = document.getElementById("adminPassword").value.trim();

        const fd = new FormData();
        fd.append("action", "login");
        fd.append("password", password);

        try {
          const res = await fetch(GOOGLE_SCRIPT_URL, {
            method: "POST",
            body: fd,
          });
          const data = await res.json();

          if (data && data.success && data.token) {
            adminToken = data.token;
            isAdminMode = true;
            adminPanel.classList.add("active");
            adminToggle.textContent = "‡∏õ‡∏¥‡∏î Admin";
            adminToggle.classList.remove("bg-fantasy-purple");
            adminToggle.classList.add("bg-fantasy-red");
            hideAdminLogin();

            // Set today's date as default
            document.getElementById("updateDate").value = new Date()
              .toISOString()
              .split("T")[0];

            refreshAdminUI(); // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
          } else {
            alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!");
            document.getElementById("adminPassword").value = "";
            document.getElementById("adminPassword").focus();
          }
        } catch (err) {
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô");
          console.error(err);
        }
      }

      function refreshAdminUI() {
        // re-render ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏≤‡∏° isAdminMode
        displayItems(currentItems);
        displayUpdates(currentUpdates);
      }

      function toggleDescription(id) {
        const element = document.getElementById(id);
        if (element) element.classList.toggle("hidden");
      }

      async function loadData() {
        await Promise.all([loadItems(), loadUpdates()]);
      }

      async function loadItems() {
        const cached = readCache(CACHE.items);
        if (cached?.items) {
          currentItems = cached.items.map((it) => ({
            ...it,
            nameLink: unwrapGoogleRedirect(it.nameLink),
          }));
          displayItems(currentItems);
          restoreFilters();
          filterItems();
        }

        const controller = new AbortController();
        const to = setTimeout(() => controller.abort(), 10_000);
        try {
          const fresh = await fetchJSON(
            `${GOOGLE_SCRIPT_URL}?action=getItems`,
            { signal: controller.signal }
          );
          clearTimeout(to);
          if (fresh?.items) {
            writeCache(CACHE.items, fresh, TTL.items);
            currentItems = fresh.items.map((it) => ({
              ...it,
              nameLink: unwrapGoogleRedirect(it.nameLink),
            }));
            // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô re-render
            displayItems(currentItems);
            restoreFilters();
            filterItems();
          }
        } catch (e) {
          if (!cached) {
            console.error("Error loading items:", e);
            document.getElementById(
              "itemsList"
            ).innerHTML = `<div class="text-center py-8 text-red-400">
                <p>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                <button onclick="loadItems()" class="mt-4 bg-fantasy-gold text-black px-4 py-2 rounded">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
              </div>`;
          }
        }
      }

      async function loadUpdates() {
        const cached = readCache(CACHE.updates);
        if (cached?.updates) {
          currentUpdates = cached.updates;
          displayUpdates(currentUpdates);
        }
        const controller = new AbortController();
        const to = setTimeout(() => controller.abort(), 10_000);
        try {
          const fresh = await fetchJSON(
            `${GOOGLE_SCRIPT_URL}?action=getUpdates`,
            { signal: controller.signal }
          );
          clearTimeout(to);
          if (fresh?.updates) {
            writeCache(CACHE.updates, fresh, TTL.updates);
            currentUpdates = fresh.updates;
            displayUpdates(currentUpdates);
          }
        } catch (e) {
          if (!cached) {
            console.error("Error loading updates:", e);
            document.getElementById(
              "updatesList"
            ).innerHTML = `<div class="text-center py-8 text-red-400">
                <p>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                <button onclick="loadUpdates()" class="mt-4 bg-fantasy-gold text-black px-4 py-2 rounded">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
              </div>`;
          }
        }
      }

      function escapeHtml(str = "") {
        return String(str)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      function displayItems(items) {
        const container = document.getElementById("itemsList");

        if (items.length === 0) {
          container.innerHTML = `
            <div class="text-center py-8 text-gray-400">
              <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
            </div>`;
          return;
        }

        const itemsHTML = `
          <div class="overflow-x-auto">
            <table class="w-full bg-gray-800 rounded-lg overflow-hidden">
              <thead class="bg-gray-900">
                <tr>
                  <th class="px-4 py-3 text-left text-fantasy-gold font-bold">‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°</th>
                  <th class="px-4 py-3 text-left text-fantasy-gold font-bold">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                  <th class="px-4 py-3 text-center text-fantasy-gold font-bold">ATN</th>
                  <th class="px-4 py-3 text-center text-fantasy-gold font-bold">‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                  <th class="px-4 py-3 text-center text-fantasy-gold font-bold">Tier</th>
                  <th class="px-4 py-3 text-center text-fantasy-gold font-bold">Rarity</th>
                  <th class="px-4 py-3 text-right text-fantasy-gold font-bold">‡∏£‡∏≤‡∏Ñ‡∏≤(GP)</th>
                  <th class="px-4 py-3 text-right text-fantasy-gold font-bold">‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</th>
                  ${
                    isAdminMode
                      ? `<th class="px-4 py-3 text-center text-fantasy-gold font-bold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>`
                      : ``
                  }
                </tr>
              </thead>
              <tbody>
                ${items
                  .map(
                    (item, index) => `
                  <tr class="border-t border-gray-700 hover:bg-gray-700 transition-colors cursor-pointer" data-row-index="${index}">
                    <td class="px-4 py-3">
                      <div class="flex items-center gap-2">
                        <button class="add-cart-btn inline-flex items-center justify-center w-6 h-6 rounded bg-black hover:bg-yellow-600/40"
                        data-add-id="${item.id}" title="‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤">üõí</button>
                        <div class="font-semibold text-white hover:text-fantasy-gold">
                          ${
                            item.nameLink
                              ? `<a href="${
                                  item.nameLink
                                }" target="_blank" rel="noopener noreferrer">${escapeHtml(
                                  item.name
                                )}</a>`
                              : `${escapeHtml(item.name)}`
                          }
                        </div>
                      </div>
                    </td>
                    <td class="px-4 py-3 text-gray-300 text-sm whitespace-normal">${escapeHtml(
                      item.type
                    )}</td>
                    <td class="px-4 py-3 text-center whitespace-nowrap">
                      <span class="px-2 py-1 rounded text-xs font-bold ${
                        item.attune === "Yes"
                          ? "bg-green-600 text-white"
                          : "bg-red-600 text-white"
                      }">
                        ${item.attune === "Yes" ? "‡πÉ‡∏ä‡πà" : "‡πÑ‡∏°‡πà"}
                      </span>
                    </td>
                    <td class="px-4 py-3 text-center whitespace-nowrap">
                      <span class="px-2 py-1 rounded text-xs font-bold ${
                        item.perdis === "‡∏ñ‡∏≤‡∏ß‡∏£"
                          ? "bg-green-600 text-white"
                          : "bg-yellow-600 text-white"
                      }">
                        ${item.perdis === "‡∏ñ‡∏≤‡∏ß‡∏£" ? "‡∏ñ‡∏≤‡∏ß‡∏£" : "‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á"}
                      </span>
                    </td>
                    <td class="px-4 py-3 text-center whitespace-nowrap">
                      <span class="px-2 py-1 rounded text-xs font-bold bg-blue-600 text-white">${escapeHtml(
                        item.tier
                      )}</span>
                    </td>
                    <td class="px-4 py-3 text-center whitespace-nowrap">
                      <span class="px-2 py-1 rounded text-xs font-bold rarity-${item.rarity
                        .toLowerCase()
                        .replace(" ", "-")}">
                        ${escapeHtml(item.rarity)}
                      </span>
                    </td>
                    <td class="px-4 py-3 text-right font-bold text-white-400 whitespace-nowrap">${escapeHtml(
                      item.price
                    )}</td>
                    <td class="px-4 py-3 text-right text-sm text-gray-400 break-words">${escapeHtml(
                      item.book
                    )}</td>
                    ${
                      isAdminMode
                        ? `
                      <td class="px-4 py-3 text-center whitespace-nowrap">
                        <div class="flex items-center justify-center gap-2">
                            <button class="btn-edit-item bg-yellow-500 hover:bg-yellow-600 text-black text-xs px-3 py-1 rounded"
                                    data-id="${item.id}">
                              ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                            <button class="btn-delete-item bg-red-600 hover:bg-red-700 text-white text-xs px-3 py-1 rounded"
                                    data-id="${
                                      item.id
                                    }" data-name="${escapeHtml(item.name)}">
                              ‡∏•‡∏ö
                            </button>
                          </div>
                      </td>`
                        : ``
                    }
                  </tr>
                  ${
                    item.description || isGenericVariant(item)
                      ? `
                    <tr id="desc-${index}" class="hidden border-t border-gray-600">
                      <td colspan="${
                        isAdminMode ? 10 : 9
                      }" class="px-4 py-3 bg-gray-800">
                        ${
                          isWeapon(item) || isArmor(item)
                            ? `
                        `
                            : ""
                        }

                        ${
                          isGenericVariant(item)
                            ? `
                          <div class="mb-3 flex items-center gap-2">
                            <span class="text-fantasy-gold font-bold">Base Item</span>
                            <button type="button" class="px-3 py-1 rounded bg-fantasy-purple hover:bg-purple-700"
                                    data-gv-pick="${item.id}">
                              ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô
                            </button>
                            <span id="gvChip-${
                              item.id
                            }" class="text-xs text-gray-300">
                              ${
                                gvMap.get(item.id)
                                  ? `${escapeHtml(
                                      gvMap.get(item.id).name
                                    )} (+${fmt(gvMap.get(item.id).price)} gp)`
                                  : "‚Äî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äî"
                              }
                            </span>
                          </div>
                        `
                            : ""
                        }

                        ${
                          isGemstone(item)
                            ? `
                          <div class="mb-3 flex items-center gap-2">
                            <span class="text-fantasy-gold font-bold">Gemstone</span>
                            <button type="button" class="px-3 py-1 rounded bg-fantasy-purple hover:bg-purple-700"
                                    data-gem-pick="${item.id}">
                              ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏ç‡∏°‡∏ì‡∏µ
                            </button>
                            <span id="gemChip-${
                              item.id
                            }" class="text-xs text-gray-300">
                              ${
                                gemMap.get(item.id)
                                  ? `${escapeHtml(
                                      gemMap.get(item.id).name
                                    )} √ó ${(
                                      gemMap.get(item.id).factor || 1
                                    ).toFixed(2)} = ${fmt(
                                      gemMap.get(item.id).final || 0
                                    )} gp`
                                  : "‚Äî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äî"
                              }
                            </span>
                          </div>
                        `
                            : ""
                        }

                        ${
                          item.description
                            ? `
                          <div class="text-gray-300 text-sm">
                            <strong class="text-fantasy-gold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong>
                            ${escapeHtml(item.description)}
                          </div>
                        `
                            : ""
                        }
                      </td>
                    </tr>
                  `
                      : ""
                  }
                `
                  )
                  .join("")}
              </tbody>
            </table>
          </div>`;

        container.innerHTML = itemsHTML;

        // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å base item (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Generic Variant)
        container.querySelectorAll("[data-gv-pick]").forEach((btn) => {
          btn.addEventListener("click", () =>
            openGVModal(btn.getAttribute("data-gv-pick"))
          );
        });

        // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏ç‡∏°‡∏ì‡∏µ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Gemstone)
        container.querySelectorAll("[data-gem-pick]").forEach((btn) => {
          btn.addEventListener("click", () =>
            openGemModal(btn.getAttribute("data-gem-pick"))
          );
        });

        // === ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ) ===
        const headerRow = container.querySelector("thead tr");
        if (headerRow && !container.querySelector("#selectAll")) {
          const th = document.createElement("th");
          th.className = "pl-2 pr-1 py-3 text-left text-fantasy-gold font-bold";
          th.innerHTML =
            '<input type="checkbox" id="selectAll" class="w-4 h-4 rounded bg-gray-700 border-gray-600">';
          headerRow.prepend(th);
        }

        // === ‡πÉ‡∏™‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏ö‡πá‡∏≠‡∏Å‡∏ã‡πå‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß + sync ‡∏Å‡∏±‡∏ö selectedIds ===
        const rows = container.querySelectorAll("tbody tr[data-row-index]");
        rows.forEach((row) => {
          const idx = Number(row.getAttribute("data-row-index"));
          const item = items[idx];
          if (!item) return;

          // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ã‡∏•‡πÄ‡∏ä‡πá‡∏Ñ‡∏ö‡πá‡∏≠‡∏Å‡∏ã‡πå (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ)
          if (!row.querySelector(".row-select")) {
            const td = document.createElement("td");
            td.className = "pl-2 pr-1 py-3 text-left";
            td.innerHTML =
              '<input type="checkbox" class="row-select w-4 h-4 rounded bg-gray-700 border-gray-600">';
            row.prepend(td);
          }

          const cb = row.querySelector(".row-select");
          cb.dataset.id = item.id;
          cb.checked = selectedIds.has(item.id);

          row.dataset.id    = item.id;
          row.dataset.name  = item.name || '';
          row.dataset.type  = item.type || '';
          row.dataset.price = item.price || '0 gp';

          // ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
          const lockReason =
            window.SELECT_RULES && window.SELECT_RULES.shouldDisable
              ? window.SELECT_RULES.shouldDisable(item)
              : null;

          if (lockReason) {
            cb.disabled = true;
            cb.checked = false;
            cb.title = lockReason;
            selectedIds.delete(item.id); // ‡∏Å‡∏±‡∏ô‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏¢‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ
            row.classList.add("opacity-60"); // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ã‡∏µ‡∏î‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
          }

          // ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
          function paint(selected) {
            row.classList.toggle("ring-1", selected);
            row.classList.toggle("ring-fantasy-gold", selected);
            row.classList.toggle("bg-gray-700/40", selected);
          }
          paint(cb.checked);

          // ‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏ä‡πá‡∏Ñ‡∏ö‡πá‡∏≠‡∏Å‡∏ã‡πå‡πÑ‡∏õ‡∏ó‡∏£‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
          cb.addEventListener("click", (e) => e.stopPropagation());
          cb.addEventListener("change", (e) => {
            const id = e.target.dataset.id;
            if (e.target.checked) selectedIds.add(id);
            else selectedIds.delete(id);
            paint(e.target.checked);
            updateBulkActionsUI();

            // sync ‡∏Å‡∏±‡∏ö selectAll ‡∏ö‡∏ô‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            const allChecked = Array.from(
              container.querySelectorAll(".row-select:not(:disabled)")
            ).every((x) => x.checked);
            const selAll = container.querySelector("#selectAll");
            if (selAll) selAll.checked = allChecked;
            const selAllTop = document.getElementById("selectAllTop");
            if (selAllTop) selAllTop.checked = allChecked && rows.length > 0;
          });
        });

        // === ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á ===
        const selectAll = container.querySelector("#selectAll");
        if (selectAll) {
          // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß
          selectAll.checked =
            rows.length > 0 &&
            Array.from(
              container.querySelectorAll(".row-select:not(:disabled)")
            ).every((x) => x.checked);

          selectAll.addEventListener("change", (e) => {
            const want = e.target.checked;
            container
              .querySelectorAll(".row-select:not(:disabled)")
              .forEach((cb) => {
                if (cb.checked !== want) {
                  cb.checked = want;
                  cb.dispatchEvent(new Event("change", { bubbles: false }));
                }
              });
            const selAllTop = document.getElementById("selectAllTop");
            if (selAllTop) selAllTop.checked = want && rows.length > 0;
          });
        }

        // === ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏™‡πÅ‡∏õ‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà ( +1 ) ===
        container.querySelectorAll('tr[id^="desc-"] td').forEach((td) => {
          td.colSpan = isAdminMode ? 10 : 9; // ‡πÄ‡∏î‡∏¥‡∏°‡∏Ñ‡∏∑‡∏≠ 9/8 ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏≤‡∏≠‡∏µ‡∏Å 1 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
        });

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ñ‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        updateBulkActionsUI();

        // ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏ñ‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠ toggle ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
        container
          .querySelectorAll("tbody tr[data-row-index]")
          .forEach((row) => {
            row.addEventListener("click", (e) => {
              // ‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏ß‡∏Å‡∏õ‡∏∏‡πà‡∏°/‡πÄ‡∏ä‡πá‡∏Ñ‡∏ö‡πá‡∏≠‡∏Å‡∏ã‡πå ‡πÑ‡∏õ‡∏ó‡∏£‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
              if (
                e.target.closest(".add-cart-btn") || // ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                e.target.closest(".row-select") || // checkbox ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ñ‡∏ß
                e.target.closest("[data-gv-pick]") || // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å base item (GV)
                e.target.closest("[data-gem-pick]") || // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏ç‡∏°‡∏ì‡∏µ
                e.target.closest(".btn-edit-item") // ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô)
              )
                return;

              const idx = row.getAttribute("data-row-index");
              toggleDescription("desc-" + idx);
            });
          });

        // ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡∏´‡∏¢‡∏∏‡∏î propagation)
        container.querySelectorAll(".btn-edit-item").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const id = btn.dataset.id;
            startEditItem(id);
          });
        });

        // ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö (‡∏´‡∏¢‡∏∏‡∏î propagation)
        container.querySelectorAll(".btn-delete-item").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const id = btn.dataset.id;
            const name = btn.dataset.name || "";
            deleteItemConfirm(id, name);
          });
        });
      }

      function displayUpdates(updates) {
        const container = document.getElementById("updatesList");

        if (updates.length === 0) {
          container.innerHTML = `
            <div class="text-center py-8 text-gray-400">
              <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó</p>
            </div>`;
          return;
        }

        container.innerHTML = updates
          .map(
            (update) => `
          <div class="bg-gray-800 rounded-lg p-6 mb-4">
            <div class="flex justify-between items-start mb-4 gap-3">
              <div>
                <h3 class="text-xl font-bold text-fantasy-gold">${escapeHtml(
                  update.title
                )}</h3>
                <span class="text-sm text-gray-400">${formatDate(
                  update.date
                )}</span>
              </div>
              ${
                isAdminMode
                  ? `
                <div class="flex gap-2">
                  <button class="btn-edit-update bg-yellow-500 hover:bg-yellow-600 text-black text-xs px-3 py-1 rounded"
                          data-id="${update.id}">
                    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                  </button>
                  <button class="btn-delete-update bg-red-600 hover:bg-red-700 text-white text-xs px-3 py-1 rounded"
                          data-id="${update.id}" data-title="${escapeHtml(
                      update.title
                    )}">
                    ‡∏•‡∏ö
                  </button>
                </div>`
                  : ``
              }
            </div>
            <div class="text-gray-300 whitespace-pre-line">${escapeHtml(
              update.content
            )}</div>
          </div>`
          )
          .join("");

        // ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó
        container.querySelectorAll(".btn-edit-update").forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = btn.dataset.id;
            startEditUpdate(id);
          });
        });

        // ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó
        container.querySelectorAll(".btn-delete-update").forEach((btn) => {
          btn.addEventListener("click", async () => {
            const id = btn.dataset.id;
            const title = btn.dataset.title || "";
            deleteUpdateConfirm(id, title);
          });
        });
      }

      function filterItems() {
        const tierFilter = document.getElementById("tierFilter").value;
        const rarityFilter = document.getElementById("rarityFilter").value;
        const attuneFilter = document.getElementById("attuneFilter").value;
        const PerDisFilter = document.getElementById("PerDisFilter").value;
        const typeFilter = document.getElementById("typeFilter").value;
        const searchFilter = document
          .getElementById("searchFilter")
          .value.toLowerCase();

        const filteredItems = currentItems.filter((item) => {
          return (
            (!tierFilter || item.tier === tierFilter) &&
            (!rarityFilter || item.rarity === rarityFilter) &&
            (!attuneFilter || item.attune === attuneFilter) &&
            (!PerDisFilter || item.perdis === PerDisFilter) &&
            (!typeFilter || item.type.includes(typeFilter)) &&
            (!searchFilter || item.name.toLowerCase().includes(searchFilter))
          );
        });

        displayItems(filteredItems);
        saveFilters();
      }

      // ===== Edit flows =====
      function startEditItem(id) {
        if (!isAdminMode || !adminToken) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô");
          return;
        }
        const item = currentItems.find((it) => it.id === id);
        if (!item) return;

        document.getElementById("itemId").value = item.id;
        document.getElementById("itemName").value = item.name || "";
        document.getElementById("itemNameLink").value = item.nameLink || "";
        document.getElementById("itemAttune").value = item.attune || "No";
        document.getElementById("itemPerDis").value = item.perdis || "‡∏ñ‡∏≤‡∏ß‡∏£";
        document.getElementById("itemType").value = item.type || "";
        document.getElementById("itemPrice").value = item.price || "";
        document.getElementById("itemTier").value = item.tier || "Tier 0";
        document.getElementById("itemRarity").value = item.rarity || "Common";
        document.getElementById("itemBook").value = item.book || "";
        document.getElementById("itemDescription").value =
          item.description || "";

        document.getElementById("itemEditHint").classList.remove("hidden");
        adminPanel.classList.add("active");
        adminPanel.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      function clearItemForm() {
        document.getElementById("itemForm").reset();
        document.getElementById("itemId").value = "";
        document.getElementById("itemEditHint").classList.add("hidden");
      }

      function startEditUpdate(id) {
        if (!isAdminMode || !adminToken) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô");
          return;
        }
        const up = currentUpdates.find((u) => u.id === id);
        if (!up) return;

        document.getElementById("updateId").value = up.id;
        document.getElementById("updateTitle").value = up.title || "";
        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏Å ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô YYYY-MM-DD ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô ISO
        const d = new Date(up.date);
        if (!isNaN(d.getTime())) {
          document.getElementById("updateDate").value = d
            .toISOString()
            .slice(0, 10);
        } else {
          document.getElementById("updateDate").value = up.date || "";
        }
        document.getElementById("updateContent").value = up.content || "";

        document.getElementById("updateEditHint").classList.remove("hidden");
        adminPanel.classList.add("active");
        adminPanel.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      function clearUpdateForm() {
        document.getElementById("updateForm").reset();
        document.getElementById("updateId").value = "";
        document.getElementById("updateEditHint").classList.add("hidden");
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢)
        document.getElementById("updateDate").value = new Date()
          .toISOString()
          .slice(0, 10);
      }

      // --- Submit handlers (‡πÅ‡∏ô‡∏ö token ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏ó‡πÄ‡∏Ñ‡πá‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏) ---
      async function handleItemSubmit(e) {
        e.preventDefault();

        if (!adminToken) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô");
          return;
        }

        const formData = new FormData();
        formData.append(
          "action",
          document.getElementById("itemId").value ? "updateItem" : "addItem"
        );
        formData.append("token", adminToken); // ‡πÅ‡∏ô‡∏ö‡πÇ‡∏ó‡πÄ‡∏Ñ‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
        formData.append("id", document.getElementById("itemId").value);
        formData.append("name", document.getElementById("itemName").value);
        formData.append(
          "nameLink",
          document.getElementById("itemNameLink").value
        );
        formData.append("attune", document.getElementById("itemAttune").value);
        formData.append("perdis", document.getElementById("itemPerDis").value);
        formData.append("type", document.getElementById("itemType").value);
        formData.append("price", document.getElementById("itemPrice").value);
        formData.append("tier", document.getElementById("itemTier").value);
        formData.append("rarity", document.getElementById("itemRarity").value);
        formData.append("book", document.getElementById("itemBook").value);
        formData.append(
          "description",
          document.getElementById("itemDescription").value
        );

        try {
          const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: "POST",
            body: formData,
          });
          const result = await response.json();
          if (result.success) {
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            clearItemForm();
            await loadItems();
          } else {
            handleAuthErrors(result);
          }
        } catch (error) {
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
          console.error(error);
        }
      }

      async function handleUpdateSubmit(e) {
        e.preventDefault();

        if (!adminToken) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô");
          return;
        }

        const formData = new FormData();
        formData.append(
          "action",
          document.getElementById("updateId").value
            ? "updateUpdate"
            : "addUpdate"
        );
        formData.append("token", adminToken); // ‡πÅ‡∏ô‡∏ö‡πÇ‡∏ó‡πÄ‡∏Ñ‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
        formData.append("id", document.getElementById("updateId").value);
        formData.append("title", document.getElementById("updateTitle").value);
        formData.append("date", document.getElementById("updateDate").value);
        formData.append(
          "content",
          document.getElementById("updateContent").value
        );

        try {
          const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: "POST",
            body: formData,
          });
          const result = await response.json();
          if (result.success) {
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            clearUpdateForm();
            await loadUpdates();
          } else {
            handleAuthErrors(result);
          }
        } catch (error) {
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
          console.error(error);
        }
      }

      // --- Delete flows with confirm() ---
      async function deleteItemConfirm(id, name) {
        if (!adminToken) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô");
          return;
        }
        const ok = confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡∏°:\n${name || id}`);
        if (!ok) return;

        const fd = new FormData();
        fd.append("action", "deleteItem");
        fd.append("token", adminToken);
        fd.append("id", id);

        try {
          const res = await fetch(GOOGLE_SCRIPT_URL, {
            method: "POST",
            body: fd,
          });
          const data = await res.json();
          if (data.success) {
            alert("‡∏•‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            await loadItems();
          } else {
            handleAuthErrors(data);
          }
        } catch (err) {
          alert("‡∏•‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          console.error(err);
        }
      }

      async function deleteUpdateConfirm(id, title) {
        if (!adminToken) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô");
          return;
        }
        const ok = confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó:\n${title || id}`);
        if (!ok) return;

        const fd = new FormData();
        fd.append("action", "deleteUpdate");
        fd.append("token", adminToken);
        fd.append("id", id);

        try {
          const res = await fetch(GOOGLE_SCRIPT_URL, {
            method: "POST",
            body: fd,
          });
          const data = await res.json();
          if (data.success) {
            alert("‡∏•‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            await loadUpdates();
          } else {
            handleAuthErrors(data);
          }
        } catch (err) {
          alert("‡∏•‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          console.error(err);
        }
      }

      function handleAuthErrors(result) {
        const msg =
          result && result.error ? String(result.error) : "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏";
        if (
          msg.includes("TOKEN_INVALID_OR_EXPIRED") ||
          msg.includes("NO_AUTH_TOKEN")
        ) {
          alert("‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà");
          // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà
          isAdminMode = false;
          adminToken = null;
          adminPanel.classList.remove("active");
          adminToggle.textContent = "Admin Panel";
          adminToggle.classList.remove("bg-fantasy-red");
          adminToggle.classList.add("bg-fantasy-purple");
          adminModal.classList.remove("hidden");
          document.getElementById("adminPassword").focus();
          refreshAdminUI();
        } else {
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + msg);
        }
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("th-TH", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }
    </script>

    <script>
      // --- Remember Filters (very small) ---
      const FILTER_KEY = 'tsm.filters.v1';

      function _els() {
        return {
          tier:   document.getElementById('tierFilter'),
          rarity: document.getElementById('rarityFilter'),
          attune: document.getElementById('attuneFilter'),
          perdis: document.getElementById('PerDisFilter'),
          type:   document.getElementById('typeFilter'),
          q:      document.getElementById('searchFilter'),
        };
      }

      function saveFilters() {
        const e = _els();
        const state = {
          tier:   e.tier?.value || '',
          rarity: e.rarity?.value || '',
          attune: e.attune?.value || '',
          perdis: e.perdis?.value || '',
          type:   e.type?.value || '',
          q:      e.q?.value || '',
        };
        localStorage.setItem(FILTER_KEY, JSON.stringify(state));
      }

      function restoreFilters() {
        try {
          const raw = localStorage.getItem(FILTER_KEY);
          if (!raw) return;
          const s = JSON.parse(raw);
          const e = _els();
          if (e.tier)   e.tier.value   = s.tier   ?? '';
          if (e.rarity) e.rarity.value = s.rarity ?? '';
          if (e.attune) e.attune.value = s.attune ?? '';
          if (e.perdis) e.perdis.value = s.perdis ?? '';
          if (e.type)   e.type.value   = s.type   ?? '';
          if (e.q)      e.q.value      = s.q      ?? '';
        } catch {}
      }
    </script>

    <script>
      // === Crafting Calculator Maps (‡∏≠‡∏¥‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Crafting) ===
      // Favor (Crafing Cost):
      // Tier 0-1: ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á=6, ‡∏ñ‡∏≤‡∏ß‡∏£=12 | T2: 10/20 | T3: 20/40 | T4: 30/60 | T5: 40/80
      const FAVOR_MAP = {
        disposable: {
          // ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á
          "Tier 0": 6,
          "Tier 1": 6,
          "Tier 2": 10,
          "Tier 3": 20,
          "Tier 4": 30,
          "Tier 5": 40,
        },
        permanent: {
          // ‡∏ñ‡∏≤‡∏ß‡∏£
          "Tier 0": 12,
          "Tier 1": 12,
          "Tier 2": 20,
          "Tier 3": 40,
          "Tier 4": 60,
          "Tier 5": 80,
        },
      };

      // DC & Checks (Crafting DC Table):
      const DC_MAP = {
        disposable: {
          "Tier 0": { dc: 12, checks: 1 },
          "Tier 1": { dc: 12, checks: 1 },
          "Tier 2": { dc: 14, checks: 4 },
          "Tier 3": { dc: 20, checks: 10 },
          "Tier 4": { dc: 22, checks: 20 },
          "Tier 5": { dc: 25, checks: 30 },
        },
        permanent: {
          "Tier 0": { dc: 14, checks: 4 },
          "Tier 1": { dc: 14, checks: 4 },
          "Tier 2": { dc: 16, checks: 8 },
          "Tier 3": { dc: 22, checks: 20 },
          "Tier 4": { dc: 26, checks: 40 },
          "Tier 5": { dc: 28, checks: 50 },
        },
      };

      function fmt(n) {
        if (n === null || n === undefined || Number.isNaN(n)) return "‚Äî";
        return n.toLocaleString(undefined, { maximumFractionDigits: 2 });
      }

      function calcCrafting() {
        const tier = document.getElementById("craftTier")?.value || "";
        const type = document.getElementById("craftType")?.value || ""; // "‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á" | "‡∏ñ‡∏≤‡∏ß‡∏£"
        const price = parseFloat(
          document.getElementById("craftPrice")?.value || ""
        ); // ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô

        // ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå
        const key =
          type === "‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á"
            ? "disposable"
            : type === "‡∏ñ‡∏≤‡∏ß‡∏£"
            ? "permanent"
            : null;

        const outFavor = document.getElementById("outFavor");
        const outDC = document.getElementById("outDC");
        const outChecks = document.getElementById("outChecks");
        const outGold = document.getElementById("outGold");

        if (!tier || !key) {
          outFavor.textContent = "‚Äî";
          outDC.textContent = "‚Äî";
          outChecks.textContent = "‚Äî";
          outGold.textContent = price > 0 ? fmt(price / 2) + " gp" : "‚Äî";
          return;
        }

        const favor = FAVOR_MAP[key][tier] ?? null;
        const dcObj = DC_MAP[key][tier] ?? { dc: null, checks: null };

        outFavor.textContent = fmt(favor);
        outDC.textContent = fmt(dcObj.dc);
        outChecks.textContent = fmt(dcObj.checks);
        outGold.textContent = price > 0 ? fmt(price / 2) + " gp" : "‚Äî";
      }

      // Hook ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå‡πÄ‡∏î‡∏¥‡∏°
      const _origSetup =
        typeof setupEventListeners === "function" ? setupEventListeners : null;
      window.setupEventListeners = function () {
        if (_origSetup) _origSetup();

        const elTier = document.getElementById("craftTier");
        const elType = document.getElementById("craftType");
        const elPrice = document.getElementById("craftPrice");
        const elReset = document.getElementById("craftReset");

        if (elTier) elTier.addEventListener("change", calcCrafting);
        if (elType) elType.addEventListener("change", calcCrafting);
        if (elPrice) elPrice.addEventListener("input", calcCrafting);
        if (elReset)
          elReset.addEventListener("click", () => {
            if (elTier) elTier.value = "";
            if (elType) elType.value = "";
            if (elPrice) elPrice.value = "";
            calcCrafting();
          });

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏ñ‡πâ‡∏≤‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
        calcCrafting();
      };

      function closeGVModal() {
        document.getElementById("gvModal")?.classList.add("hidden");
      }

      function openGVModal(itemId) {
        const item = (currentItems || []).find(
          (x) => String(x.id) === String(itemId)
        );
        if (!item) return;

        const modal = document.getElementById("gvModal");
        const titleEl = document.getElementById("gvTitle");
        const listEl = document.getElementById("gvList");
        const search = document.getElementById("gvSearch");

        const kind = guessGVKind(item);
        titleEl.textContent =
          kind === "armor"
            ? "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏£‡∏≤‡∏∞/‡πÇ‡∏•‡πà (Base Item)"
            : "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò (Base Item)";

        const baseList = getBaseCandidatesForVariant(item);

        function render(q = "") {
          const term = q.trim().toLowerCase();
          listEl.innerHTML = baseList
            .filter((x) => !term || String(x.name).toLowerCase().includes(term))
            .map(
              (x) => `
              <div class="flex items-center gap-3 px-4 py-2 border-b border-gray-700/40">
                <div class="flex-1">
                  <div>${escapeHtml(x.name)}</div>
                  <div class="text-xs text-gray-400">‚Üí ${escapeHtml(
                    x.resultName
                  )}</div>
                </div>
                <div class="w-24 text-right tabular-nums">${fmt(
                  x.price
                )} gp</div>
                <button class="px-2 py-1 rounded bg-fantasy-purple hover:bg-purple-700 text-white"
                        data-pick="${item.id}" data-bid="${x.id}"
                        data-name="${escapeHtml(
                          x.name
                        )}" data-rname="${escapeHtml(x.resultName)}"
                        data-price="${x.price}">
                  ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                </button>
              </div>
            `
            )
            .join("");

          listEl.querySelectorAll("[data-pick]").forEach((btn) => {
            btn.addEventListener("click", (e) => {
              const name = e.currentTarget.dataset.name;
              const rname = e.currentTarget.dataset.rname; // ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
              const price = Number(e.currentTarget.dataset.price) || 0;
              gvMap.set(item.id, {
                kind,
                id: e.currentTarget.dataset.bid,
                name,
                resultName: rname,
                price,
              });
              const chip = document.getElementById(`gvChip-${item.id}`);
              if (chip) chip.textContent = `${rname} (+${fmt(price)} gp)`;
              closeGVModal();
            });
          });
        }

        render();
        search.value = "";
        search.oninput = () => render(search.value);
        modal.classList.remove("hidden");
        document.getElementById("gvClose").onclick = closeGVModal;
        modal.onclick = (e) => {
          if (e.target === modal) closeGVModal();
        };
      }
    </script>

    <script>
      // ===== Gemstone Variant state =====
      const gemMap = new Map(); // itemId -> { name, base, factor, final }

      function isGemstone(it) {
        const t = String(it.type || "")
          .trim()
          .toLowerCase();
        return t === "gemstone";
      }

      // ‡∏î‡∏∂‡∏á "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤" 10/50/100/500/1000/5000 ‡∏à‡∏≤‡∏Å item (‡∏î‡∏π price ‡∏Å‡πà‡∏≠‡∏ô, ‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô‡∏•‡∏≠‡∏á‡πÄ‡∏î‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠)
      function getGemBaseFromItem(item) {
        const priceNum = parsePrice(item?.price);
        if (priceNum && window.GEM_GROUPS?.[priceNum]) return priceNum;

        const m = String(item?.name || "").match(/(\d[\d,]*)\s*gp/i);
        if (m) {
          const v = Number(m[1].replace(/,/g, ""));
          if (window.GEM_GROUPS?.[v]) return v;
        }
        // ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô null (‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏à‡∏∞‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°)
        return null;
      }

      function closeGemModal() {
        document.getElementById("gemModal")?.classList.add("hidden");
      }

      function openGemModal(itemId) {
        const item = (currentItems || []).find(x => String(x.id) === String(itemId));
        if (!item) return;

        const modal  = document.getElementById("gemModal");
        const listEl = document.getElementById("gemList");
        const search = document.getElementById("gemSearch");

        const base   = getGemBaseFromItem(item);            // 10/50/100/500/1000/5000 ‡∏´‡∏£‡∏∑‡∏≠ null
        const groups = window.GEM_GROUPS || {};
        const rules  = window.GEM_RULES  || {};

        // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏ç‡∏°‡∏ì‡∏µ (‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°)
        const rows = [];
        const keys = base ? [base] : Object.keys(groups).map(Number).sort((a,b)=>a-b);
        keys.forEach(k => {
          const factor = rules[k] || 1;
          (groups[k] || []).forEach(name => {
            rows.push({ name, base: k, factor }); // ‡πÑ‡∏°‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì final ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß
          });
        });

        function currentWorth() {
          const inp = document.getElementById("gemWorth");
          return Math.max(0, Number(inp?.value) || 0);
        }

        function render(q = "") {
          const worth = currentWorth();
          const term  = q.trim().toLowerCase();
          const data  = rows.filter(x => !term || x.name.toLowerCase().includes(term));

          listEl.innerHTML = data.map(x => `
            <div class="flex items-center gap-3 px-4 py-2 border-b border-gray-700/40">
              <div class="flex-1">
                <div>${escapeHtml(x.name)}</div>
                <div class="text-xs text-gray-400">
                  ‚Üí ${fmt(worth)} gp √ó ${x.factor.toFixed(2)}
                  = <span class="text-fantasy-gold">${fmt(Math.round(worth * x.factor))} gp</span>
                </div>
              </div>
              <button class="px-2 py-1 rounded bg-fantasy-purple hover:bg-purple-700 text-white"
                      data-pick="${item.id}"
                      data-name="${escapeHtml(x.name)}"
                      data-base="${x.base}"
                      data-factor="${x.factor}"
                      data-worth="${worth}"
                      data-final="${Math.round(worth * x.factor)}">
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
              </button>
            </div>
          `).join("");

          // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å" ‡πÉ‡∏´‡πâ‡∏à‡∏î choice ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô gemMap ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏¥‡∏õ‡∏ö‡∏ô‡πÅ‡∏ñ‡∏ß‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
          listEl.querySelectorAll("[data-pick]").forEach(btn => {
            btn.addEventListener("click", (e) => {
              const el = e.currentTarget;
              const sel = {
                name:   el.dataset.name,
                base:   Number(el.dataset.base)   || 0,
                factor: Number(el.dataset.factor) || 1,
                worth:  Number(el.dataset.worth)  || 0,
                final:  Number(el.dataset.final)  || 0
              };
              gemMap.set(item.id, sel);
              const chip = document.getElementById(`gemChip-${item.id}`);
              if (chip) chip.textContent =
                `${sel.name}:${fmt(sel.worth)} √ó ${sel.factor.toFixed(2)} = ${fmt(sel.final)} gp`;
              closeGemModal();
            });
          });
        }

        // bind worth + search
        const worthInput = document.getElementById("gemWorth");
        if (worthInput) {
          if (!worthInput.value) worthInput.value = "100";
          worthInput.oninput = () => render(search.value);
        }

        render();
        search.value = "";
        search.oninput = () => render(search.value);

        modal.classList.remove("hidden");
        document.getElementById("gemClose").onclick = closeGemModal;
        modal.onclick = (e) => { if (e.target === modal) closeGemModal(); };
      }

      // helper ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏õ Discord
      function getGemAddon(it) {
        const sel = gemMap.get(it.id);
        if (!sel) return null;
        return { name: sel.name, factor: sel.factor, worth: sel.worth, final: sel.final };
      }
    </script>

    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("./sw.js");
      }
      document.addEventListener('visibilitychange', async () => {
        if (document.visibilityState !== 'visible') return;
        saveFilters();
        await loadData();       // ‡πÇ‡∏´‡∏•‡∏î items+updates ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß :contentReference[oaicite:4]{index=4}
        restoreFilters();
        filterItems();
      });
    </script>

    <!-- Cloudflare -->
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'96dc47c042052dc4',t:'MTc1NDk2Mjk5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
